var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
var KEY_UP=1,KEY_RIGHT=2,KEY_DOWN=3,KEY_LEFT=4,KEY_ACTION=5,KEY_ESC=6,keyboard=Array(8);function is_key_pressed(a){return keyboard[a]}function set_key_pressed(a,b){37==a?keyboard[KEY_LEFT]=b:38==a?keyboard[KEY_UP]=b:39==a?keyboard[KEY_RIGHT]=b:40==a?keyboard[KEY_DOWN]=b:32==a||13==a?keyboard[KEY_ACTION]=b:27==a&&(keyboard[KEY_ESC]=b)}
var VAR_SCROLL_Y=249,VAR_HERO_ACTION=250,VAR_HERO_POS_JUMP_DOWN=251,VAR_HERO_POS_LEFT_RIGHT=252,VAR_HERO_POS_MASK=253,VAR_HERO_ACTION_POS_MASK=254,VAR_PAUSE_SLICES=255,vars=Array(256),tasks=Array(64),bytecode,palette,polygons1,polygons2,bytecode_offset,task_num,task_paused,next_part,delay=0,timestamp;function read_byte(){var a=bytecode[bytecode_offset];bytecode_offset+=1;return a}function read_word(){var a=bytecode[bytecode_offset]<<8|bytecode[bytecode_offset+1];bytecode_offset+=2;return a}
function to_signed(a,b){return a-((a&1<<b-1)<<1)}
var opcodes={0:function(){var a=read_byte(),b=to_signed(read_word(),16);vars[a]=b},1:function(){var a=read_byte(),b=read_byte();vars[a]=vars[b]},2:function(){var a=read_byte(),b=read_byte();vars[a]+=vars[b]},3:function(){var a=read_byte(),b=to_signed(read_word(),16);vars[a]+=b},4:function(){var a=read_word();tasks[task_num].stack.push(bytecode_offset);bytecode_offset=a},5:function(){bytecode_offset=tasks[task_num].stack.pop()},6:function(){task_paused=!0},7:function(){bytecode_offset=read_word()},
8:function(){var a=read_byte(),b=read_word();tasks[a].next_offset=b},9:function(){var a=read_byte();--vars[a];var b=read_word();0!=vars[a]&&(bytecode_offset=b)},10:function(){var a=read_byte(),b=vars[read_byte()];var c=a&128?vars[read_byte()]:a&64?to_signed(read_word(),16):read_byte();var d=read_word();switch(a&7){case 0:b==c&&(bytecode_offset=d);break;case 1:b!=c&&(bytecode_offset=d);break;case 2:b>c&&(bytecode_offset=d);break;case 3:b>=c&&(bytecode_offset=d);break;case 4:b<c&&(bytecode_offset=d);
break;case 5:b<=c&&(bytecode_offset=d)}},11:function(){next_palette=read_word()>>8},12:function(){var a=read_byte(),b=read_byte(),c=read_byte();if(2==c)for(;a<=b;++a)tasks[a].next_offset=-2;else for(console.assert(0==c||1==c);a<=b;++a)tasks[a].next_state=c},13:function(){select_page(read_byte())},14:function(){var a=read_byte(),b=read_byte();fill_page(a,b)},15:function(){var a=read_byte(),b=read_byte();copy_page(a,b,vars[VAR_SCROLL_Y])},16:function(){var a=read_byte();delay+=1E3*vars[VAR_PAUSE_SLICES]/
50;vars[247]=0;update_display(a)},17:function(){bytecode_offset=-1;task_paused=!0},18:function(){var a=read_word(),b=read_byte(),c=read_byte(),d=read_byte();draw_string(a,d,b,c)},19:function(){var a=read_byte(),b=read_byte();vars[a]-=vars[b]},20:function(){var a=read_byte(),b=read_word();vars[a]=to_signed(vars[a]&b&65535,16)},21:function(){var a=read_byte(),b=read_word();vars[a]=to_signed((vars[a]|b)&65535,16)},22:function(){var a=read_byte(),b=read_word()&15;vars[a]=to_signed(vars[a]<<b&65535,16)},
23:function(){var a=read_byte(),b=read_word()&15;vars[a]=to_signed((vars[a]&65535)>>b,16)},24:function(){read_word();read_byte();read_byte();read_byte()},25:function(){var a=read_word();16E3<a&&(next_part=a);console.log(" load num:"+a)},26:function(){read_word();read_word();read_byte()}};
function execute_task(){for(;!task_paused;){var a=read_byte();if(a&128){a=(a<<8|read_byte())<<1&65534;var b=read_byte(),c=read_byte(),d=c-199;0<d&&(c=199,b+=d);draw_shape(polygons1,a,255,64,b,c)}else if(a&64){d=read_word()<<1&65534;b=read_byte();0==(a&32)?b=0==(a&16)?b<<8|read_byte():vars[b]:a&16&&(b+=256);c=read_byte();0==(a&8)&&(c=0==(a&4)?c<<8|read_byte():vars[c]);var e=polygons1,f=read_byte();0==(a&2)?0==(a&1)?(--bytecode_offset,f=64):f=vars[f]:a&1&&(e=polygons2,--bytecode_offset,f=64);draw_shape(e,
d,255,f,b,c)}else console.assert(26>=a),opcodes[a]()}}
function update_input(){var a=0;is_key_pressed(KEY_RIGHT)?(vars[VAR_HERO_POS_LEFT_RIGHT]=1,a|=1):is_key_pressed(KEY_LEFT)?(vars[VAR_HERO_POS_LEFT_RIGHT]=-1,a|=2):vars[VAR_HERO_POS_LEFT_RIGHT]=0;is_key_pressed(KEY_DOWN)?(vars[VAR_HERO_POS_JUMP_DOWN]=1,a|=4):is_key_pressed(KEY_UP)?(vars[VAR_HERO_POS_JUMP_DOWN]=-1,a|=8):vars[VAR_HERO_POS_JUMP_DOWN]=0;vars[VAR_HERO_POS_MASK]=a;is_key_pressed(KEY_ACTION)?(vars[VAR_HERO_ACTION]=1,a|=128):vars[VAR_HERO_ACTION]=0;vars[VAR_HERO_ACTION_POS_MASK]=a}
function run_tasks(){0!=next_part&&(restart(next_part),next_part=0);for(var a=0;a<tasks.length;++a){tasks[a].state=tasks[a].next_state;var b=tasks[a].next_offset;-1!=b&&(tasks[a].offset=-2==b?-1:b,tasks[a].next_offset=-1)}update_input();for(a=0;a<tasks.length;++a)0==tasks[a].state&&(b=tasks[a].offset,-1!=b&&(bytecode_offset=b,tasks[a].stack.length=0,task_num=a,task_paused=!1,execute_task(),tasks[a].offset=bytecode_offset))}
function load(a,b){a=atob(a);if(a.length!=b){var c=decrunch.uncompress(a);console.assert(c.length==b);return c}c=Array(b);for(b=0;b<a.length;++b)c[b]=a.charCodeAt(a[b])&255;return c}
function restart(a){16001==a?(palette=load(data17,size17),bytecode=load(data18,size18),polygons1=load(data19,size19),polygons2=null):16002==a?(palette=load(data1a,size1a),bytecode=load(data1b,size1b),polygons1=load(data1c,size1c),polygons2=load(data11,size11)):16003==a?(palette=load(data1d,size1d),bytecode=load(data1e,size1e),polygons1=load(data1f,size1f),polygons2=load(data11,size11)):16004==a?(palette=load(data20,size20),bytecode=load(data21,size21),polygons1=load(data22,size22),polygons2=load(data11,
size11)):16005==a?(palette=load(data23,size23),bytecode=load(data24,size24),polygons1=load(data25,size25),polygons2=load(data11,size11)):16006==a?(palette=load(data26,size26),bytecode=load(data27,size27),polygons1=load(data28,size28),polygons2=load(data11,size11)):16007==a?(palette=load(data29,size29),bytecode=load(data2a,size2a),polygons1=load(data2b,size2b),polygons2=load(data11,size11)):16008==a&&(palette=load(data7d,size7d),bytecode=load(data7e,size7d),polygons1=load(data7f,size7f),polygons2=
null);for(a=0;a<tasks.length;++a)tasks[a]={state:0,next_state:0,offset:-1,next_offset:-1},tasks[a].stack=[];tasks[0].offset=0}var SCALE=2,SCREEN_W=320*SCALE,SCREEN_H=200*SCALE,PAGE_SIZE=SCREEN_W*SCREEN_H,buffer8=new Uint8Array(4*PAGE_SIZE),palette32=new Uint32Array(48),current_page0,current_page1,current_page2,next_palette=-1,PALETTE_TYPE_AMIGA=0,PALETTE_TYPE_EGA=1,PALETTE_TYPE_VGA=2,palette_type=PALETTE_TYPE_AMIGA;
function get_page(a){if(255==a)return current_page2;if(254==a)return current_page1;console.assert(4>a);return a}function select_page(a){current_page0=get_page(a)}function fill_page(a,b){a=get_page(a);buffer8.fill(b,a*PAGE_SIZE,(a+1)*PAGE_SIZE)}
function copy_page(a,b,c){b=get_page(b);254<=a?(a=get_page(a),buffer8.set(buffer8.subarray(a*PAGE_SIZE,(a+1)*PAGE_SIZE),b*PAGE_SIZE)):(a=get_page(a&3),b!=a&&(c=0,0==c?buffer8.set(buffer8.subarray(a*PAGE_SIZE,(a+1)*PAGE_SIZE),b*PAGE_SIZE):c>-SCREEN_W&&c<SCREEN_W&&(0>c?buffer8.set(buffer8.subarray(a*PAGE_SIZE-c*SCREEN_W,a*PAGE_SIZE),b*PAGE_SIZE):buffer8.set(buffer8.subarray(a*PAGE_SIZE,a*PAGE_SIZE+(SCREEN_H-c)*SCREEN_W),b*PAGE_SIZE+c*SCREEN_W))))}
function draw_point(a,b,c,d){if(!(0>c||c>=SCREEN_W||0>d||d>=SCREEN_H)){var e=a*PAGE_SIZE+d*SCREEN_W+c;17==b?(console.log(0!=a),buffer8[e]=buffer8[d*SCREEN_W+c]):16==b?buffer8[e]|=8:(console.assert(16>b),buffer8[e]=b)}}
function draw_line(a,b,c,d,e){var f=Math.min(d,e);d=Math.max(d,e);if(!(f>=SCREEN_W||0>d))if(0>f&&(f=0),d>=SCREEN_W&&(d=SCREEN_W-1),e=a*PAGE_SIZE+c*SCREEN_W,17==b)console.assert(0!=a),buffer8.set(buffer8.subarray(c*SCREEN_W+f,c*SCREEN_W+d+1),e+f);else if(16==b)for(a=f;a<=d;++a)buffer8[e+a]|=8;else console.assert(16>b),buffer8.fill(b,e+f,e+d+1)}
function draw_polygon(a,b,c){var d=0,e=c.length-1,f=Math.min(c[d].y,c[e].y),g=c[d++].x,h=c[e--].x,l=h<<16,k=g<<16,m=c.length;for(m-=2;0!=m;m-=2){g=c[e].y-c[e+1].y;var n=(c[e].x-c[e+1].x<<16)/(0==g?1:g)>>0;--e;var p=c[d].y-c[d-1].y,q=(c[d].x-c[d-1].x<<16)/(0==p?1:p)>>0;d+=1;l=l&4294901760|32767;k=k&4294901760|32768;if(0==p)l+=n,k+=q;else for(var r=0;r<p;++r)if(0<=f&&(h=l>>16,g=k>>16,draw_line(a,b,f,h,g)),l+=n,k+=q,f+=1,f>=SCREEN_H)return}}
function fill_polygon(a,b,c,d,e,f){var g=(a[b++]*d/64>>0)*SCALE,h=(a[b++]*d/64>>0)*SCALE,l=e*SCALE-g/2>>0,k=e*SCALE+g/2>>0,m=f*SCALE-h/2>>0,n=f*SCALE+h/2>>0;if(!(l>=SCREEN_W||0>k||m>=SCREEN_H||0>n)){k=a[b++];console.assert(0==(k&1));n=[];for(var p=0;p<k;++p){var q=l+(a[b++]*d/64>>0)*SCALE,r=m+(a[b++]*d/64>>0)*SCALE;n.push({x:q,y:r})}4==k&&0==g&&1>=h?draw_point(current_page0,c,e,f):draw_polygon(current_page0,c,n)}}
function draw_shape_parts(a,b,c,d,e,f){e=e-a[b++]*d/64>>0;f=f-a[b++]*d/64>>0;for(var g=a[b++],h=0;h<=g;++h){var l=a[b]<<8|a[b+1];b+=2;var k=e+a[b++]*d/64>>0,m=f+a[b++]*d/64>>0;c=255;l&32768&&(c=a[b]&127,b+=2);draw_shape(a,l<<1&65534,c,d,k,m)}}function draw_shape(a,b,c,d,e,f){var g=a[b++];192<=g?(c&128&&(c=g&63),fill_polygon(a,b,c,d,e,f)):2==(g&63)&&draw_shape_parts(a,b,c,d,e,f)}
function draw_char(a,b,c,d,e){if(d<40*SCALE&&e<192*SCALE)for(a=a*PAGE_SIZE+(8*d+e*SCREEN_W)*SCALE,e=0;8>e;++e){var f=font[8*(b-32)+e];for(d=0;8>d;++d)if(0!=(f&1<<7-d))for(var g=0;g<SCALE;++g)for(var h=0;h<SCALE;++h)buffer8[a+g*SCREEN_W+d*SCALE+h]=c;a+=SCREEN_W*SCALE}}function draw_string(a,b,c,d){if(a in strings){var e=c;a=strings[a];for(var f=0;f<a.length;++f){var g=a.charCodeAt(f);10==g?(d+=8,c=e):(draw_char(current_page0,g,b,c,d),c+=1)}}}
var PALETTE_EGA=[0,0,0,0,0,170,0,170,0,0,170,170,170,0,0,170,0,170,170,85,0,170,170,170,85,85,85,85,85,255,85,255,85,85,255,255,255,85,85,255,85,255,255,255,85,255,255,255];function set_palette_ega(a){for(var b=0;16>b;++b){var c=palette[a+2*b]<<8|palette[a+2*b+1];c=3*(c>>12&15);palette32[16*PALETTE_TYPE_EGA+b]=4278190080|PALETTE_EGA[c+2]<<16|PALETTE_EGA[c+1]<<8|PALETTE_EGA[c]}}
function set_palette_444(a,b){for(var c=0;16>c;++c){var d=palette[a+2*c]<<8|palette[a+2*c+1],e=d>>8&15;e|=e<<4;var f=d>>4&15;f|=f<<4;d&=15;d|=d<<4;palette32[16*b+c]=4278190080|d<<16|f<<8|e}}
function update_display(a){254!=a&&(255==a?(a=current_page1,current_page1=current_page2,current_page2=a):current_page1=get_page(a));-1!=next_palette&&(a=32*next_palette,set_palette_444(a,PALETTE_TYPE_AMIGA),set_palette_ega(a+1024),set_palette_444(a+1024,PALETTE_TYPE_VGA),next_palette=-1);update_screen(current_page1*PAGE_SIZE)}
function reset(){current_page2=1;current_page1=2;current_page0=get_page(254);buffer8.fill(0);next_palette=-1;vars.fill(0);vars[188]=16;vars[198]=128;vars[242]=6E3;vars[220]=33;vars[228]=20;next_part=16001;timestamp=Date.now()}function tick(){var a=Date.now();for(delay-=a-timestamp;0>=delay;)run_tasks();timestamp=a}var INTERVAL=50,canvas,timer;
function init(a){canvas=document.getElementById(a);document.onkeydown=function(a){set_key_pressed(a.keyCode,1)};document.onkeyup=function(a){set_key_pressed(a.keyCode,0)};reset();timer&&clearInterval(timer);timer=setInterval(tick,INTERVAL)}function pause(){if(timer)return clearInterval(timer),timer=null,!0;timer=setInterval(tick,INTERVAL);return!1}function mute(){}function change_palette(a){palette_type=a}
function update_screen(a){for(var b=canvas.getContext("2d"),c=b.getImageData(0,0,SCREEN_W,SCREEN_H),d=new Uint32Array(c.data.buffer),e=0;e<SCREEN_W*SCREEN_H;++e)d[e]=palette32[16*palette_type+buffer8[a+e]];b.putImageData(c,0,0)}
var decrunch={m_in:null,m_inptr:0,m_out:null,m_outptr:0,m_size:0,m_bits:0,m_crc:0,m_code:0,readWord:function(a,b){for(var c=0,d=0;4>d;d+=1)c*=256,c+=a.charCodeAt(b+d);return c},getBit:function(a){var b=this.m_bits&1;this.m_bits>>>=1;a&&(this.m_bits|=-2147483648);return b},nextBit:function(){var a=this.getBit(0);0==this.m_bits&&(this.m_bits=this.readWord(this.m_in,this.m_inptr),this.m_inptr-=4,this.m_crc^=this.m_bits,a=this.getBit(1));return a},readBits:function(a){for(var b=0,c=0;c<a;c+=1)b*=2,this.nextBit()&&
(b+=1);return b},copyLiteral:function(a,b){a=this.readBits(a)+b+1;for(b=0;b<a;b+=1)this.m_out[this.m_outptr]=this.readBits(8),--this.m_outptr;this.m_size-=a},copyReference:function(a){a=this.readBits(a);for(var b=this.m_code+1,c=0;c<b;c+=1)this.m_out[this.m_outptr]=this.m_out[this.m_outptr+a],--this.m_outptr;this.m_size-=b},uncompress:function(a){this.m_in=a;this.m_inptr=a.length-4;this.m_size=this.readWord(this.m_in,this.m_inptr);this.m_inptr-=4;this.m_crc=this.readWord(this.m_in,this.m_inptr);this.m_inptr-=
4;this.m_bits=this.readWord(this.m_in,this.m_inptr);this.m_inptr-=4;this.m_crc^=this.m_bits;this.m_out=Array(this.m_size);for(this.m_outptr=this.m_size-1;0<this.m_size;)if(this.nextBit())switch(a=this.readBits(2),a){case 3:this.copyLiteral(8,8);break;case 2:this.m_code=this.readBits(8);this.copyReference(12);break;default:this.m_code=a+2,this.copyReference(a+9)}else this.m_code=1,this.nextBit()?this.copyReference(8):this.copyLiteral(3,0);console.assert(0==this.m_crc);return this.m_out}};
